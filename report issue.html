<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PUBLICFIX</title>

    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #6366f1, #0ea5e9);
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            color: white;
            margin: 30px 0;
            letter-spacing: 1px;
        }

        .container {
            width: 92%;
            max-width: 750px;
            margin: auto;
        }

        .card-box {
            background: white;
            padding: 22px;
            border-radius: 14px;
            margin-bottom: 22px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        input,
        textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        textarea {
            resize: none;
            height: 80px;
        }

        button {
            background: #4f46e5;
            color: white;
            padding: 11px 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            opacity: 0.9;
        }

        .feed-card {
            border-top: 1px solid #eee;
            padding: 15px 0;
        }

        .feed-card img {
            width: 100%;
            border-radius: 12px;
            margin: 8px 0;
        }

        .priority-high {
            color: #dc2626;
            font-weight: 700;
        }

        .priority-medium {
            color: #ea580c;
            font-weight: 700;
        }

        .priority-low {
            color: #16a34a;
            font-weight: 700;
        }

        .location-box {
            display: flex;
            gap: 10px;
        }

        .location-box input {
            flex: 1;
        }
    </style>
</head>

<body>

    <h1>PUBLICFIX</h1>

    <div class="container">

        <div class="card-box">
            <h3>Report an Issue</h3>

            <input type="file" id="photo" accept="image/*">
            <textarea id="desc" placeholder="Describe the issue..."></textarea>

            <div class="location-box">
                <input id="location" placeholder="Enter location manually">
                <button onclick="getLocation()">üìç Auto</button>
            </div>

            <button onclick="addComplaint()">Submit Complaint</button>
        </div>

        <div class="card-box">
            <h3>Community Feed</h3>
            <div id="feed"></div>
        </div>

    </div>

    <script>
        let complaints = JSON.parse(localStorage.getItem("complaints")) || [];

        function save() {
            localStorage.setItem("complaints", JSON.stringify(complaints));
        }

        function getLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation not supported");
                return;
            }

            navigator.geolocation.getCurrentPosition(pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;

                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById("location").value = data.display_name;
                    });
            }, () => alert("Location access denied"));
        }

        function addComplaint() {
            const desc = document.getElementById("desc").value.trim();
            const location = document.getElementById("location").value.trim();
            const photoInput = document.getElementById("photo");

            if (!desc || !location) {
                alert("Please fill all fields");
                return;
            }

            const addData = (photo) => {
                complaints.push({
                    id: Date.now(),
                    desc,
                    location,
                    photo,
                    status: "Pending",
                    upvotes: 0
                });

                save();
                clearForm();
                render();
            };

            if (photoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = () => addData(reader.result);
                reader.readAsDataURL(photoInput.files[0]);
            } else {
                addData("");
            }
        }

        function clearForm() {
            document.getElementById("desc").value = "";
            document.getElementById("location").value = "";
            document.getElementById("photo").value = "";
        }

        function render() {
            const feed = document.getElementById("feed");
            feed.innerHTML = "";

            complaints.sort((a, b) => b.upvotes - a.upvotes).forEach(c => {
                let priority = "Low", cls = "priority-low";
                if (c.upvotes >= 5) { priority = "High"; cls = "priority-high"; }
                else if (c.upvotes >= 2) { priority = "Medium"; cls = "priority-medium"; }

                const div = document.createElement("div");
                div.className = "feed-card";
                div.innerHTML = `
            ${c.photo ? `<img src="${c.photo}">` : ""}
            <p><b>Issue:</b> ${c.desc}</p>
            <p>üìç <b>${c.location}</b></p>
            <p>Status: <b>${c.status}</b></p>
            <p>Priority: <span class="${cls}">${priority}</span></p>
            <button onclick="upvote(${c.id})">üëç ${c.upvotes}</button>
        `;
                feed.appendChild(div);
            });
        }

        function upvote(id) {
            const item = complaints.find(c => c.id === id);
            item.upvotes++;
            save();
            render();
        }

        render();
    </script>

</body>

</html>